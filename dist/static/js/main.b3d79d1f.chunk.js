(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,a){},23:function(e,t,a){e.exports=a(39)},32:function(e,t,a){},33:function(e,t,a){},34:function(e,t,a){},35:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(18),r=a.n(i),o=a(3),c=a(4),l=a(6),u=a(5),h=a(7),d=a(1),m=a(40),v=a(44),g=(a(17),Object(v.a)(function(e){var t=e.login,a=e.authFail,n=e.isLogging;return s.a.createElement("form",{className:"loginForm",onSubmit:t},a?s.a.createElement("div",{className:"authFailMessage"},"\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c!"):"",s.a.createElement("span",null,s.a.createElement("input",{type:"login",name:"login",placeholder:"login"}),s.a.createElement("input",{type:"password",name:"password",placeholder:"password"})),s.a.createElement("span",null,s.a.createElement("input",{disabled:n,type:"submit",value:"\u0412\u043e\u0439\u0442\u0438"})))})),f=Object(v.a)(function(e){var t=e.isAdmin,a=e.authFail,n=e.logoff,i=e.login;return s.a.createElement("div",{className:"headerArea"},s.a.createElement(m.a,{className:"header",to:"/"},s.a.createElement("h1",null,"XRay-test")),t?s.a.createElement("div",{className:"loginArea"},"\u0412\u0445\u043e\u0434 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d",s.a.createElement("a",{className:"logoff",onClick:n},"\u0412\u044b\u0439\u0442\u0438")):s.a.createElement(g,{login:i,authFail:a}))}),p=(a(32),function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"menuItem"},s.a.createElement(m.a,{className:"menuButton",to:"/test"},"\u041d\u0430\u0447\u0430\u0442\u044c \u0442\u0435\u0441\u0442")),s.a.createElement("div",{className:"menuItem"},s.a.createElement(m.a,{className:"menuButton",to:"/admin"},"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438")))}}]),t}(s.a.Component)),b=Object(v.a)(p),y=(a(33),function(e){return e.json().then(function(t){return e.ok?t:Promise.reject(t)})}),w=function(e){return localStorage.setItem("token",e)},k=function(){return!!localStorage.getItem("token")&&localStorage.getItem("token")},E={right:"\u041f\u043e\u0437\u0434\u0440\u0430\u0432\u043b\u044f\u0435\u043c! \u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442.",yellow:"\u041e\u0448\u0438\u0431\u043a\u0430! \u041e\u043f\u0430\u0441\u043d\u044b\u0445 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043e\u0432 \u043d\u0435\u0442!",red1:"\u041e\u0448\u0438\u0431\u043a\u0430! \u041e\u043f\u0430\u0441\u043d\u044b\u0439 \u043f\u0440\u0435\u0434\u043c\u0435\u0442 \u0435\u0441\u0442\u044c!",red2:"\u041e\u0448\u0438\u0431\u043a\u0430! \u041e\u043f\u0430\u0441\u043d\u043e\u0433\u043e \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u0430 \u043d\u0435\u0442 \u0432 \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u043e\u0439 \u0412\u0430\u043c\u0438 \u043e\u0431\u043b\u0430\u0441\u0442\u0438!",time:"\u0412\u0440\u0435\u043c\u044f \u0438\u0441\u0442\u0435\u043a\u043b\u043e!"},j=a(22),C=a(12),O=function(){function e(t){Object(o.a)(this,e),this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.zones=[],this.x1=0,this.x2=0,this.y1=0,this.y2=0,this.prevProperties=[0,0,0,0],this.clearListeners(),this.isDrawing=!1,this.handelMouseUp=this.handelMouseUp.bind(this),this.handelMouseMove=this.handelMouseMove.bind(this),this.handelMouseDown=this.handelMouseDown.bind(this),this.clearZones=this.clearZones.bind(this)}return Object(c.a)(e,[{key:"handelMouseDown",value:function(e){this.isDrawing=!0,this.x1=e.offsetX,this.y1=e.offsetY}},{key:"handelMouseMove",value:function(e){if(this.isDrawing){this.clearPreviousRect(),this.x2=e.offsetX,this.y2=e.offsetY;var t=this.getRectProperties();this.drawRect(t),this.prevProperties=t}}},{key:"handelMouseUp",value:function(e){this.isDrawing=!1,this.clearPreviousRect(),this.x2=e.offsetX,this.y2=e.offsetY;var t=this.getRectProperties();this.drawRect(t),this.prevProperties=[0,0,0,0],this.saveZones()}},{key:"drawRect",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red";this.ctx.strokeStyle=a,(t=this.ctx).rect.apply(t,Object(C.a)(e)),this.ctx.stroke()}},{key:"clearPreviousRect",value:function(){var e=Object(j.a)(this.prevProperties,4),t=e[0],a=e[1],n=e[2],s=e[3];this.ctx.clearRect(t-1,a-1,n+2,s+2),this.ctx.beginPath()}},{key:"saveZones",value:function(){var e=this.getLeftUpCorner(),t=this.getRightDownCorner();this.zones.push([].concat(Object(C.a)(e),Object(C.a)(t)))}},{key:"drawOldZones",value:function(e){var t=this;this.zones=e,e.forEach(function(e){var a=[e[0],e[1]],n=e[2]-e[0],s=e[3]-e[1];a.push(n),a.push(s),t.drawRect(a)})}},{key:"placeUserClick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red",a=e.x,n=e.y;this.drawCircle(a,n,10,t),this.drawLine(a-10,n,a-5,n),this.drawLine(a+10,n,a+5,n),this.drawLine(a,n+10,a,n+5),this.drawLine(a,n-10,a,n-5)}},{key:"drawCircle",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"red";this.ctx.beginPath(),this.ctx.strokeStyle=n,this.ctx.arc(e,t,a,0,2*Math.PI),this.ctx.stroke()}},{key:"drawLine",value:function(e,t,a,n){arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(a,n),this.ctx.stroke()}},{key:"getLeftUpCorner",value:function(){var e=this.x1,t=this.x2,a=this.y1,n=this.y2;return[Math.min(e,t),Math.min(a,n)]}},{key:"getRightDownCorner",value:function(){var e=this.x1,t=this.x2,a=this.y1,n=this.y2;return[Math.max(e,t),Math.max(a,n)]}},{key:"getRectProperties",value:function(){var e=this.getLeftUpCorner(),t=this.getRightDownCorner(),a=t[0]-e[0],n=t[1]-e[1];return[].concat(Object(C.a)(e),[a,n])}},{key:"start",value:function(){this.canvas.addEventListener("mousedown",this.handelMouseDown),this.canvas.addEventListener("mouseup",this.handelMouseUp),this.canvas.addEventListener("mousemove",this.handelMouseMove)}},{key:"clearListeners",value:function(){this.canvas.removeEventListener("mousedown",this.handelMouseDown),this.canvas.removeEventListener("mouseup",this.handelMouseUp),this.canvas.removeEventListener("mousemove",this.handelMouseMove)}},{key:"getZones",value:function(){return this.zones}},{key:"clearZones",value:function(){this.zones=[],this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath()}},{key:"reset",value:function(){this.clearListeners(),this.clearZones()}}]),e}(),S=function(e){function t(e){var a;Object(o.a)(this,t);var n=(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).props,s=n.settings,i=n.question;return a.state={settings:s,question:i,canvasBackground:"#canvasBackground",canvasDraw:"#canvasDrawArea",comment:E.right,warningShowed:!1,answered:!1,result:0,slideShowed:!1,clickAllowed:!1,photoShowed:!1},a.setClear=a.setClear.bind(Object(d.a)(Object(d.a)(a))),a.nextQuestion=a.nextQuestion.bind(Object(d.a)(Object(d.a)(a))),a.handleCanvasClick=a.handleCanvasClick.bind(Object(d.a)(Object(d.a)(a))),a.clearTimers=a.clearTimers.bind(Object(d.a)(Object(d.a)(a))),a.setQuestionTimers=a.setQuestionTimers.bind(Object(d.a)(Object(d.a)(a))),a.showWarning=a.showWarning.bind(Object(d.a)(Object(d.a)(a))),a.handleTimer=a.handleTimer.bind(Object(d.a)(Object(d.a)(a))),a.prepareCanvas=a.prepareCanvas.bind(Object(d.a)(Object(d.a)(a))),a.setNewQuestion=a.setNewQuestion.bind(Object(d.a)(Object(d.a)(a))),a.showPhoto=a.showPhoto.bind(Object(d.a)(Object(d.a)(a))),a.timers=[],a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.canvasDraw;this.drawer=this.props.drawer||new O(document.querySelector(e)),this.prepareCanvas=this.props.prepareCanvas||this.prepareCanvas,this.setNewQuestion()}},{key:"componentDidUpdate",value:function(e,t){var a=e.question;this.props.question.name!==a.name&&this.setNewQuestion()}},{key:"componentWillUnmount",value:function(){this.clearTimers()}},{key:"setNewQuestion",value:function(){var e=this.props,t=e.settings,a=e.question;this.setState({settings:t,question:a,comment:E.right,answered:!1,slideShowed:!0,warningShowed:!1,result:0},this.prepareCanvas)}},{key:"prepareCanvas",value:function(){var e=this;this.setCanvasDimensions();var t=new Image;t.src=this.state.question.imgPath,t.onload=function(){e.setCanvasBackground(t),e.animateSlideShow().then(function(){e.setQuestionTimers(),e.setState({clickAllowed:!0})}).catch(window.alert)}}},{key:"animateSlideShow",value:function(){var e=this;return new Promise(function(t,a){var n=e.getCanvasBackground(),s=e.getCanvasDraw();n.offsetLeft===s.offsetLeft?t():e.getCanvasBackground().addEventListener("animationend",t)})}},{key:"setCanvasDimensions",value:function(){var e=this.state.question.dimensions,t=e.width,a=e.height;this.getCanvasDraw().width=t,this.getCanvasDraw().height=a,this.getCanvasBackground().width=t,this.getCanvasBackground().height=a}},{key:"setCanvasBackground",value:function(e){return this.getCanvasBackground().getContext("2d").drawImage(e,0,0)}},{key:"drawDangerZone",value:function(e){var t=this.state.question.dangerZones;return t.length>0&&this.drawer.drawOldZones(t)}},{key:"getCanvasDraw",value:function(){return document.querySelector(this.state.canvasDraw)}},{key:"getCanvasBackground",value:function(){return document.querySelector(this.state.canvasBackground)}},{key:"setClear",value:function(){var e=this.state.question.isDanger,t=this.state.settings.redError;"1"===e?this.setState({click:null,comment:E.red1,result:t},this.finishQuestion):this.setState({click:null},this.finishQuestion)}},{key:"setTimer",value:function(e,t){var a=this.timers.length;this.timers[a]=setTimeout(e,t)}},{key:"setQuestionTimers",value:function(){var e=this.state.settings,t=e.timeWarning,a=e.time;this.setTimer(this.showWarning,1e3*t),this.setTimer(this.handleTimer,1e3*a)}},{key:"clearTimers",value:function(){this.timers.forEach(function(e){clearTimeout(e)}),this.timers=[]}},{key:"handleTimer",value:function(){var e,t=this.state.answered,a=this.state.settings,n=a.redError,s=a.yellowError,i=this.state.question.isDanger;return!t&&(e="1"===i?n:s,this.setState({comment:E.time,answered:!0,result:e},this.finishQuestion))}},{key:"showWarning",value:function(){return this.setState({warningShowed:!0})}},{key:"handleCanvasClick",value:function(e){e.persist();var t=e.nativeEvent.offsetX,a=e.nativeEvent.offsetY,n=this.state.answered,s=this.state.question.isDanger,i=this.state.settings.yellowError;return n||this.setState({click:{x:t,y:a}}),"0"!==s||n?this.checkIfClickInDangerZone(e.nativeEvent):this.setState({comment:E.yellow,result:i},this.finishQuestion)}},{key:"checkIfClickInDangerZone",value:function(e){var t=e.offsetX,a=e.offsetY,n=this.state.answered,s=this.state.question.dangerZones,i=this.state.settings.redError,r=s.some(function(e){return t>e[0]&&a>e[1]&&t<e[2]&&a<e[3]});n||(r?this.finishQuestion():this.setState({comment:E.red2,result:i},this.finishQuestion)),r&&this.showPhoto(e)}},{key:"showPhoto",value:function(e){var t=this;this.setState({photoShowed:!0},function(){t.handlePhotoPosition(e),t.setTimer(t.setState.bind(t,{photoShowed:!1}),2e3)})}},{key:"handlePhotoPosition",value:function(e){var t=document.querySelector(".dangerPicture");if(!t)return!1;t.style.top=e.clientY-t.naturalHeight/2+"px",t.style.left=e.clientX-t.naturalWidth/2+"px",this.setTimer(function(){return t.classList.add("naturalSize")},20)}},{key:"finishQuestion",value:function(){var e=this;this.setState({answered:!0},function(){e.clearTimers(),e.drawDangerZone(),e.showResult()})}},{key:"showResult",value:function(){var e=this.state,t=e.result,a=e.click,n=e.comment,s=e.question;return(0,this.props.sendResult)({result:t,click:a,comment:n,question:s})}},{key:"nextQuestion",value:function(){var e=this.props.nextQuestion;return this.setState({slideShowed:!1,clickAllowed:!1}),e()}},{key:"render",value:function(){var e=this,t=this.state,a=t.answered,n=t.question,i=t.warningShowed,r=t.result,o=t.photoShowed,c=t.comment,l=t.slideShowed,u=t.clickAllowed,h=this.state.settings.yellowError,d=n.dangerPicture;return s.a.createElement("div",null,s.a.createElement("div",null,"\u0412\u043e\u043f\u0440\u043e\u0441 ",n.name),s.a.createElement("div",{className:"canvasArea"},s.a.createElement("div",{className:"actionComment_container speech"},a?s.a.createElement("div",{id:"actionComment",className:0===r?"green":r===h?"yellow":"red"},a?c:""):""),s.a.createElement("div",{className:"markIcon_cotainer"},a?s.a.createElement("span",{id:"markIcon",className:0===r?"greenMark":r===h?"yellowError":"redError"}):""),s.a.createElement("div",{className:"clearButton_container"},s.a.createElement("button",{id:"clearButton",disabled:a||!u,onClick:this.setClear},"\u2611")),s.a.createElement("div",{className:"canvas_container"},l?s.a.createElement("canvas",{className:"animatedShow",id:"canvasBackground"}):""),s.a.createElement("div",{className:"canvas_container"},s.a.createElement("canvas",{id:"canvasDrawArea",onClick:u?function(t){return e.handleCanvasClick(t)}:function(){}})),s.a.createElement("div",{className:"timerWarning_container"},i?s.a.createElement("span",{id:"timerWarning"},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0412\u0440\u0435\u043c\u044f \u0438\u0441\u0442\u0435\u043a\u0430\u0435\u0442!"):""),s.a.createElement("div",{className:"forwardButton_container"},s.a.createElement("button",{id:"forwardButton",disabled:!a||o,onClick:this.nextQuestion},"\u25ba"))),s.a.createElement("img",{className:o?"dangerPicture":"hidden",src:d,alt:"\u041e\u043f\u0430\u0441\u043d\u044b\u0439 \u043f\u0440\u0435\u0434\u043c\u0435\u0442"}))}}]),t}(s.a.PureComponent),D=Object(v.a)(S),N=(a(34),Object(v.a)(function(e){var t=e.handleSubmit,a=e.handleChange;return s.a.createElement("div",null,s.a.createElement("div",{className:"paranja"}),s.a.createElement("div",{className:"userLoginArea"},s.a.createElement("form",{className:"userLogin",onSubmit:t},s.a.createElement("div",null,s.a.createElement("span",null,s.a.createElement("label",null,"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f: \u2003",s.a.createElement("input",{type:"text",id:"user",onChange:a,required:!0}))),s.a.createElement("span",null,s.a.createElement("input",{type:"submit",value:"\u041d\u0430\u0447\u0430\u0442\u044c \u0442\u0435\u0441\u0442"}))))))})),q=(a(35),function(e){function t(e){var a;Object(o.a)(this,t);var n=(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).props,s=n.testHistory,i=n.settings;return a.state={settings:i,testHistory:s,answer:{},currentQuestion:0,canvasBackground:"#canvasBackground",canvasDraw:"#canvasDrawArea"},a.closeHistory=a.closeHistory.bind(Object(d.a)(Object(d.a)(a))),a.getNext=a.getNext.bind(Object(d.a)(Object(d.a)(a))),a.getPrev=a.getPrev.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.canvasDraw;this.drawer=this.props.drawer||new O(document.querySelector(e)),this.prepareCanvas=this.props.prepareCanvas||this.prepareCanvas,this.setCurrentQuestion()}},{key:"setCurrentQuestion",value:function(){var e=this.state.currentQuestion,t=this.state.testHistory[e];this.setState({answer:t},this.prepareCanvas)}},{key:"prepareCanvas",value:function(){var e=this;this.setCanvasDimensions();var t=new Image;t.src=this.state.answer.question.imgPath,t.onload=function(){e.setCanvasBackground(t),e.placeUserClick()}}},{key:"setCanvasBackground",value:function(e){return this.getCanvasBackground().getContext("2d").drawImage(e,0,0)}},{key:"placeUserClick",value:function(){var e=this.state.answer.click;e&&this.drawer.placeUserClick(e)}},{key:"setCanvasDimensions",value:function(){var e=this.state.answer.question.dimensions,t=e.width,a=e.height;this.getCanvasDraw().width=t,this.getCanvasDraw().height=a,this.getCanvasBackground().width=t,this.getCanvasBackground().height=a}},{key:"getCanvasDraw",value:function(){return document.querySelector(this.state.canvasDraw)}},{key:"getCanvasBackground",value:function(){return document.querySelector(this.state.canvasBackground)}},{key:"closeHistory",value:function(){var e=this.props.closeHistory;return e()}},{key:"getPrev",value:function(){var e=this.state.currentQuestion;if(0===e)return!1;this.setState({currentQuestion:e-1},this.setCurrentQuestion)}},{key:"getNext",value:function(){var e=this.state,t=e.currentQuestion;if(t===e.testHistory.length-1)return!1;this.setState({currentQuestion:t+1},this.setCurrentQuestion)}},{key:"render",value:function(){var e=this.state.answer,t=e.result,a=e.comment,n=e.click,i=this.state.settings.yellowError;return s.a.createElement("div",null,s.a.createElement("a",{className:"closeButton",onClick:this.closeHistory},"\u0437\u0430\u043a\u0440\u044b\u0442\u044c"),s.a.createElement("div",null,s.a.createElement("span",{onClick:this.getPrev,className:"prev nav"}),s.a.createElement("span",{onClick:this.getNext,className:"next nav"})),s.a.createElement("div",{className:"canvasArea"},s.a.createElement("div",{className:"actionComment_container speech"},s.a.createElement("div",{id:"actionComment",className:0===t?"green":t===i?"yellow":"red"},a)),s.a.createElement("div",{className:"markIcon_cotainer"},s.a.createElement("span",{id:"markIcon",className:0===t?"greenMark":t===i?"yellowError":"redError"})),n?"":s.a.createElement("div",{className:"clearButton_container"},s.a.createElement("button",{id:"clearButton",className:"highlighted"},"\u2611")),s.a.createElement("div",{className:"canvas_container"},s.a.createElement("canvas",{id:"canvasBackground"})),s.a.createElement("div",{className:"canvas_container"},s.a.createElement("canvas",{id:"canvasDrawArea"}))))}}]),t}(s.a.PureComponent)),Q=Object(v.a)(q),T=(a(36),a(21)),x=a.n(T),P="http://K47_8:9245",B=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=arguments.length>1?arguments[1]:void 0,a={method:e,mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json",token:k()}};return t&&Object.assign(a,{body:JSON.stringify(t)}),a},M=function(e,t){return new Promise(function(a,n){fetch("".concat(P,"/").concat(e),B("POST",t)).then(y).then(function(e){return a(e)}).catch(function(e){return n(e)})})},A=function(e,t){return new Promise(function(a,n){fetch("".concat(P,"/").concat(e),B("GET",t)).then(y).then(function(e){return a(e)}).catch(function(e){return n(e)})})},F=function(e,t){return new Promise(function(a,n){fetch("".concat(P,"/").concat(e),B("DELETE",t)).then(y).then(function(e){return a(e)}).catch(function(e){return n(e)})})},L=function(e,t){return new Promise(function(a,n){var s;fetch("".concat(P,"/").concat(e),(s=t,{method:"POST",mode:"cors",body:s,headers:{token:k()}})).then(y).then(function(e){return a(e)}).catch(function(e){return n(e)})})},R=function(e,t){return fetch("".concat(P,"/").concat(e),{method:"GET",mode:"cors",headers:{token:k()}}).then(function(e){return e.blob()}).then(function(e){return x()(e,t)})},H=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={loading:!1,testStarted:!1,testFinished:!1,user:"",settings:{},tests:[],currentQuestion:-1,questions:[],testHistory:[],historyMode:!1,total:100},a.setSettings=a.setSettings.bind(Object(d.a)(Object(d.a)(a))),a.handleChange=a.handleChange.bind(Object(d.a)(Object(d.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(d.a)(Object(d.a)(a))),a.nextQuestion=a.nextQuestion.bind(Object(d.a)(Object(d.a)(a))),a.sendResult=a.sendResult.bind(Object(d.a)(Object(d.a)(a))),a.showHistory=a.showHistory.bind(Object(d.a)(Object(d.a)(a))),a.closeHistory=a.closeHistory.bind(Object(d.a)(Object(d.a)(a))),a.finishTest=a.finishTest.bind(Object(d.a)(Object(d.a)(a))),a.getData=a.props.getData||A,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getSettings(),this.getTests()}},{key:"handleChange",value:function(e){var t={};t[e.target.id]=e.target.value,this.setState(t)}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.chooseTest()}},{key:"getSettings",value:function(){var e=this;return this.getData("settings").then(function(t){return e.setSettings(t)}).catch(function(t){return e.setState({err:!0})})}},{key:"getTests",value:function(){var e=this;return this.getData("tests").then(function(t){return e.setState({tests:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"setSettings",value:function(e){var t={};e.forEach(function(e){t[e.name]=e.value}),this.setState({settings:t})}},{key:"chooseTest",value:function(){var e=this.state.tests,t=e.length,a=e[Math.floor(Math.random()*t)].name;this.getQuestions(a)}},{key:"getQuestions",value:function(e){var t=this;return this.getData("questions/".concat(e)).then(function(e){return t.setState({questions:e},t.setCurrentQuestion)}).catch(function(e){return window.alert(e)})}},{key:"setCurrentQuestion",value:function(){var e=this.state.currentQuestion+1;e<this.state.questions.length?this.setState({testStarted:!0,currentQuestion:e}):this.setState({testFinished:!0,testStarted:!1})}},{key:"nextQuestion",value:function(){return this.setCurrentQuestion()}},{key:"sendResult",value:function(e){var t=this.state,a=t.total,n=t.testHistory;a-=e.result,n.push(e),this.setState({total:a,testHistory:n})}},{key:"showHistory",value:function(){this.setState({historyMode:!0})}},{key:"closeHistory",value:function(){this.setState({historyMode:!1})}},{key:"finishTest",value:function(){this.setState({testFinished:!0,testStarted:!1})}},{key:"render",value:function(){var e=this.state,t=e.testStarted,a=e.settings,n=e.currentQuestion,i=e.questions,r=e.total,o=e.testFinished,c=e.historyMode,l=e.testHistory,u=this.props,h=u.drawer,d=u.prepareCanvas,m=a.errorThreshold;return s.a.createElement("div",{className:"container"},c?s.a.createElement(Q,{testHistory:l,closeHistory:this.closeHistory,settings:a}):t?s.a.createElement("div",{className:"testArea"},s.a.createElement("div",null,"\u0418\u0442\u043e\u0433\u043e: ",r,"%"),s.a.createElement(D,{prepareCanvas:d,drawer:h,question:i[n],settings:a,sendResult:this.sendResult,nextQuestion:this.nextQuestion})):o?s.a.createElement("div",{className:"resultArea"},s.a.createElement("div",null,s.a.createElement("h2",null,"\u0412\u0430\u0448 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:",s.a.createElement("span",{className:r<m?"fail":r<100?"enought":"perfect"}," ",r,"%"))),s.a.createElement("div",null,s.a.createElement("a",{onClick:this.showHistory},"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043e\u0442\u0432\u0435\u0442\u044b"))):s.a.createElement("div",{className:"userArea"},s.a.createElement(N,{handleChange:this.handleChange,handleSubmit:this.handleSubmit})))}}]),t}(s.a.Component),I=Object(v.a)(H),Z=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={questions:[],settings:[],tests:[],submitting:!1,err:!1},a.deleteObj=a.deleteObj.bind(Object(d.a)(Object(d.a)(a))),a.refreshTest=a.refreshTest.bind(Object(d.a)(Object(d.a)(a))),a.handleChange=a.handleChange.bind(Object(d.a)(Object(d.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(d.a)(Object(d.a)(a))),a.saveDb=a.saveDb.bind(Object(d.a)(Object(d.a)(a))),a.handleDbRecovery=a.handleDbRecovery.bind(Object(d.a)(Object(d.a)(a))),a.getData=a.props.getData||A,a.postData=a.props.postData||M,a.postFile=a.props.postFile||L,a.deleteData=a.props.deleteData||F,a.downloadFile=a.props.downloadFile||R,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getSettings(),this.getTests(),this.getQuestions()}},{key:"getSettings",value:function(){var e=this;return this.getData("settings").then(function(t){return e.setState({settings:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"getTests",value:function(){var e=this;return this.getData("tests").then(function(t){return e.setState({tests:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"getQuestions",value:function(){var e=this;return this.getData("questions").then(function(t){return e.setState({questions:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"getTestData",value:function(){this.getTests(),this.getQuestions()}},{key:"deleteObj",value:function(e,t){var a=this;if(window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"))return this.deleteData("deleteobj/".concat(e,"/").concat(t)).then(function(e){return a.getTestData()}).catch(function(e){return a.setState({err:!0})})}},{key:"refreshTest",value:function(e){return this.postData("test",{name:e}).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e!")}).catch(window.alert)}},{key:"handleChange",value:function(e){var t=e.target,a=t.value,n=t.type,s=(e.target&&e.target.dataset).description,i=e.target.id,r=this.state.settings;a=this.handleTypes(a,n),r.forEach(function(e,t){i===e.name&&(r[t]={_id:e._id,name:i,value:a,type:n,description:s})}),this.setState({settings:r})}},{key:"handleTypes",value:function(e,t){var a={number:function(){return Number(e)}};return a[t]?a[t](e):e}},{key:"saveDb",value:function(){var e=this;return this.setState({submitting:!0}),this.getData("savedb").then(function(){e.downloadFile("download_dump/tests.json","tests.json"),setTimeout(function(){return e.downloadFile("download_dump/questions.json","questions.json")},100)}).catch(window.alert).finally(function(){return e.setState({submitting:!1})})}},{key:"handleDbRecovery",value:function(e){var t=this;if(e.preventDefault(),window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b? \u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u0430!")){this.setState({submitting:!0});var a=this.props.handleFormData||this.handleFormData();return this.postFile("loaddb",a).then(function(){window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e!"),t.getTestData()}).catch(window.alert).finally(function(){return t.setState({submitting:!1})})}}},{key:"handleFormData",value:function(){var e=document.querySelector('input[type="file"][name="questions"]'),t=document.querySelector('input[type="file"][name="tests"]'),a=new FormData;return a.append("questions",e.files[0]),a.append("tests",t.files[0]),a}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.setState({submitting:!0});var a=this.state.settings;return this.postData("settings",{settings:a}).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!")}).catch(window.alert).finally(function(){return t.setState({submitting:!1})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.settings,n=t.tests,i=t.questions,r=t.submitting;return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"newTest"},s.a.createElement("div",{className:"menuItem"},s.a.createElement(m.a,{className:"menuButton",to:"/create/test"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0442\u0435\u0441\u0442"),s.a.createElement(m.a,{className:"menuButton",to:"/create/question"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441")),s.a.createElement("div",{className:"dbControls"},s.a.createElement("button",{disabled:r,className:"menuButton small saveDb",onClick:this.saveDb},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0431\u0430\u0437\u0443"),s.a.createElement("form",{className:"loadDb",onSubmit:this.handleDbRecovery},s.a.createElement("label",null," \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 JSON \u0444\u0430\u0439\u043b \u0441 \u0432\u043e\u043f\u0440\u043e\u0441\u0430\u043c\u0438 \u2003",s.a.createElement("input",{type:"file",name:"questions",accept:".json",required:!0})),s.a.createElement("br",null),s.a.createElement("label",null," \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 JSON \u0444\u0430\u0439\u043b \u0441 \u0442\u0435\u0441\u0442\u0430\u043c\u0438 \u2003",s.a.createElement("input",{type:"file",name:"tests",accept:".json",required:!0})),s.a.createElement("br",null),s.a.createElement("input",{disabled:r,type:"submit",value:"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0431\u0430\u0437\u0443"})))),s.a.createElement("h2",null,"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"),s.a.createElement("div",{className:"formArea"},s.a.createElement("form",{onSubmit:this.handleSubmit},a.map(function(t){return s.a.createElement("div",{key:t._id},s.a.createElement("label",null,t.description,": \u2003",s.a.createElement("input",{id:t.name,"data-description":t.description,type:t.type,value:t.value,onChange:e.handleChange})))}),s.a.createElement("div",null,s.a.createElement("input",{disabled:r,type:"submit",value:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})))),s.a.createElement("div",null),s.a.createElement("div",{className:"oldTest"},s.a.createElement("h2",null,"\u0422\u0435\u0441\u0442\u044b"),s.a.createElement("ul",null,n.map(function(t){return s.a.createElement("li",{key:t._id},t.name," \u2003",s.a.createElement("a",{onClick:function(){return e.refreshTest(t.name)}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")," \u2003",s.a.createElement("a",{className:"danger",onClick:function(){return e.deleteObj("Test",t.name)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))}))),s.a.createElement("div",{className:"oldQuestions"},s.a.createElement("h2",null,"\u0412\u043e\u043f\u0440\u043e\u0441\u044b"),s.a.createElement("ul",null,i.map(function(t){return s.a.createElement("li",{key:t._id},t.name," \u2003",s.a.createElement(m.a,{to:"/create/question?question=".concat(t.name)},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"),"\u2003",s.a.createElement("a",{className:"danger",onClick:function(){return e.deleteObj("Question",t.name)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))}))))}}]),t}(s.a.Component),_=Object(v.a)(Z),U=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("h1",null,"403 \u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430"),s.a.createElement("h3",null,"\u0417\u0430\u043b\u043e\u0433\u0438\u043d\u044c\u0442\u0435\u0441\u044c \u0434\u043b\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f"))}}]),t}(s.a.Component),W=Object(v.a)(U),X=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={err:!1,loading:!1,name:""},a.handleChange=a.handleChange.bind(Object(d.a)(Object(d.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(d.a)(Object(d.a)(a))),a.postData=e.postData||M,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var a=this.state.name;return this.setState({loading:!0}),this.postData("test",{name:a}).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!")}).catch(window.alert).finally(function(){return t.setState({loading:!1})})}},{key:"handleChange",value:function(e){var t={};t[e.target.id]=e.target.value,this.setState(t)}},{key:"render",value:function(){var e=this.state.loading;return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"formArea"},s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("div",null,s.a.createElement("span",null,s.a.createElement("label",null,"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u0441\u0442\u0430: \u2003",s.a.createElement("input",{id:"name",onChange:this.handleChange,type:"number",min:"1"}))),s.a.createElement("span",null,s.a.createElement("input",{disabled:e,type:"submit",value:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}))))))}}]),t}(s.a.Component),z=Object(v.a)(X),Y=(a(37),function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(l.a)(this,Object(u.a)(t).call(this))).state={loading:!1,err:!1,imgPath:"",dimensions:{width:0,height:0},dangerZones:[],name:"",isDanger:"1"},e.handleChange=e.handleChange.bind(Object(d.a)(Object(d.a)(e))),e.uploadPhotos=e.uploadPhotos.bind(Object(d.a)(Object(d.a)(e))),e.handleUpload=e.handleUpload.bind(Object(d.a)(Object(d.a)(e))),e.clearCanvas=e.clearCanvas.bind(Object(d.a)(Object(d.a)(e))),e.saveQuestion=e.saveQuestion.bind(Object(d.a)(Object(d.a)(e))),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({canvasBackground:"#canvasBackground",canvasDraw:"#canvasDrawArea"}),this.drawer=this.props.drawer||new O(document.querySelector("#canvasDrawArea")),this.postFile=this.props.postFile||L,this.postData=this.props.postData||M,this.getData=this.props.getData||A,this.prepareCanvas=this.props.prepareCanvas||this.prepareCanvas,this.checkIfQuestionCreated()}},{key:"componentWillUnmount",value:function(){this.drawer.reset()}},{key:"getCanvasDraw",value:function(){return document.querySelector(this.state.canvasDraw)}},{key:"getCanvasBackground",value:function(){return document.querySelector(this.state.canvasBackground)}},{key:"checkIfQuestionCreated",value:function(){if(this.props.location&&this.props.location.search.length>0){var e=new URLSearchParams(this.props.location.search).get("question");return this.getQuestion(e)}}},{key:"getQuestion",value:function(e){var t=this;return this.getData("question/".concat(e)).then(function(e){e&&t.setState(e,t.prepareCanvas)}).catch(window.alert)}},{key:"uploadPhotos",value:function(e){var t=this;e.preventDefault();var a=this.props.handleFormData||this.handleFormData(),n=this.props.handleUpload||this.handleUpload;this.setState({loading:!0}),this.postFile("preupload",a).then(n).catch(window.alert).finally(function(){return t.setState({loading:!1})})}},{key:"handleUpload",value:function(e){var t=this.state.name,a="/images/".concat(t,"_slide.").concat(e.type);this.drawer.reset(),this.setState({imgPath:a,dimensions:e},this.prepareCanvas)}},{key:"handleFormData",value:function(){var e=document.querySelector('input[name="slide"]'),t=document.querySelector('input[name="photo"]'),a=this.state,n=a.name,s=a.isDanger,i=new FormData;return i.append("question",n),i.append("slide",e.files[0]),"1"===s&&i.append("photo",t.files[0]),i}},{key:"handleChange",value:function(e){var t={};t[e.target.id]=e.target.value,this.setState(t)}},{key:"prepareCanvas",value:function(){var e=this;this.setCanvasDimensions();var t=new Image;t.src=this.state.imgPath,t.onload=function(){e.setCanvasBackground(t),e.drawDangerZone()}}},{key:"setCanvasDimensions",value:function(){var e=this.state.dimensions,t=e.width,a=e.height;this.getCanvasDraw().width=t,this.getCanvasDraw().height=a,this.getCanvasBackground().width=t,this.getCanvasBackground().height=a}},{key:"setCanvasBackground",value:function(e){return this.getCanvasBackground().getContext("2d").drawImage(e,0,0)}},{key:"drawDangerZone",value:function(e){var t=this.state.dangerZones;return t.length>0&&this.drawer.drawOldZones(t),this.drawer.start()}},{key:"clearCanvas",value:function(){return this.drawer.clearZones()}},{key:"saveQuestion",value:function(){var e=this,t=this.state,a=t.imgPath,n=t.name,s=t.isDanger,i=t.dimensions,r={name:n,isDanger:s,dangerZones:this.drawer.getZones(),imgPath:a,dimensions:i};return this.setState({loading:!0}),this.postData("savequestion",r).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!")}).catch(window.alert).finally(function(){return e.setState({loading:!1})})}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.isDanger,n=e.name;return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"formArea"},s.a.createElement("form",{onSubmit:this.uploadPhotos},s.a.createElement("div",null,s.a.createElement("label",null,"\u0412\u043e\u043f\u0440\u043e\u0441: \u2003",s.a.createElement("input",{id:"name",onChange:this.handleChange,pattern:"[0-9]+_[0-9]+",name:"name",type:"text",value:n.length>0?n:"",placeholder:"\u2116 \u0422\u0435\u0441\u0442\u0430_\u2116 \u0432\u043e\u043f\u0440\u043e\u0441\u0430",required:!0}))),s.a.createElement("div",null,s.a.createElement("label",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u043b\u0430\u0439\u0434: \u2003",s.a.createElement("input",{name:"slide",type:"file",required:!0}))),s.a.createElement("div",null,s.a.createElement("label",null,"\u0411\u0430\u0433\u0430\u0436 \u043e\u043f\u0430\u0441\u0435\u043d? \u2003",s.a.createElement("select",{id:"isDanger",onChange:this.handleChange,value:"1"===a?"1":"0"},s.a.createElement("option",{value:"1"},"\u0414\u0430"),s.a.createElement("option",{value:"0"},"\u043d\u0435\u0442")))),"1"===a?s.a.createElement("div",null,s.a.createElement("label",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0444\u043e\u0442\u043e: \u2003",s.a.createElement("input",{name:"photo",type:"file",required:!0}))):s.a.createElement("span",null),s.a.createElement("div",null,s.a.createElement("input",{disabled:t,type:"submit",value:"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c"})))),s.a.createElement("div",null,s.a.createElement("div",{className:"canvasControls"},s.a.createElement("button",{className:"danger",onClick:this.clearCanvas},"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c"),s.a.createElement("button",{className:"success",disabled:t||""===n,onClick:this.saveQuestion},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")),s.a.createElement("div",{className:"createQuestion canvasArea"},s.a.createElement("canvas",{id:"canvasBackground"}),s.a.createElement("canvas",{id:"canvasDrawArea"}))))}}]),t}(s.a.Component)),J=Object(v.a)(Y),G=a(42),K=a(43),V=a(41),$=(a(38),function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={isAdmin:!1,authFail:!1,isLogging:!1,token:void 0},a.login=a.login.bind(Object(d.a)(Object(d.a)(a))),a.logoff=a.logoff.bind(Object(d.a)(Object(d.a)(a))),a.handleAuth=a.handleAuth.bind(Object(d.a)(Object(d.a)(a))),a.postData=a.props.postData||M,a.setToken=a.props.setToken||w,a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"login",value:function(e){var t=this;e.preventDefault();var a={login:e.target.login.value,password:e.target.password.value};return this.setState({isLogging:!0}),this.postData("login",a).then(this.handleAuth).catch(console.log).finally(function(){return t.setState({isLogging:!1})})}},{key:"handleAuth",value:function(e){e.auth&&this.setToken(e.token),this.setState({isAdmin:e.auth,authFail:!e.auth,token:e.token})}},{key:"logoff",value:function(){this.setState({isAdmin:!1,token:void 0}),this.setToken(null)}},{key:"render",value:function(){var e=this.state,t=e.isAdmin,a=e.authFail,n=e.isLogging;return s.a.createElement(G.a,null,s.a.createElement("div",null,s.a.createElement(f,{isAdmin:t,authFail:a,isLogging:n,login:this.login,logoff:this.logoff}),s.a.createElement(K.a,null,s.a.createElement(V.a,{path:"/",render:b,exact:!0}),s.a.createElement(V.a,{path:"/test",render:I}),s.a.createElement(V.a,{path:"/admin",render:t?_:W}),s.a.createElement(V.a,{path:"/create/test",render:t?z:W}),s.a.createElement(V.a,{path:"/create/question",render:t?J:W}))))}}]),t}(s.a.Component));r.a.render(s.a.createElement($,null),document.getElementById("root"))}},[[23,1,2]]]);
//# sourceMappingURL=main.b3d79d1f.chunk.js.map