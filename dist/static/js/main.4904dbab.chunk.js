(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{16:function(e,t,n){},22:function(e,t,n){e.exports=n(37)},31:function(e,t,n){},32:function(e,t,n){},33:function(e,t,n){},34:function(e,t,n){},35:function(e,t,n){},36:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(17),r=n.n(i),o=n(3),c=n(4),u=n(6),l=n(5),h=n(7),d=n(1),m=n(39),v=n(43),f=(n(16),Object(v.a)(function(e){var t=e.login,n=e.authFail,a=e.isLogging;return s.a.createElement("form",{className:"loginForm",onSubmit:t},n?s.a.createElement("div",{className:"authFailMessage"},"\u041d\u0435\u0432\u0435\u0440\u043d\u043e\u0435 \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c!"):"",s.a.createElement("span",null,s.a.createElement("input",{type:"login",name:"login",placeholder:"login"}),s.a.createElement("input",{type:"password",name:"password",placeholder:"password"})),s.a.createElement("span",null,s.a.createElement("input",{disabled:a,type:"submit",value:"\u0412\u043e\u0439\u0442\u0438"})))})),g=Object(v.a)(function(e){var t=e.isAdmin,n=e.authFail,a=e.logoff,i=e.login;return s.a.createElement("div",{className:"headerArea"},s.a.createElement(m.a,{className:"header",to:"/"},s.a.createElement("h1",null,"XRay-test")),t?s.a.createElement("div",{className:"loginArea"},"\u0412\u0445\u043e\u0434 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d",s.a.createElement("a",{className:"logoff",onClick:a},"\u0412\u044b\u0439\u0442\u0438")):s.a.createElement(f,{login:i,authFail:n}))}),b=(n(31),function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"menuItem"},s.a.createElement(m.a,{className:"menuButton",to:"/test"},"\u041d\u0430\u0447\u0430\u0442\u044c \u0442\u0435\u0441\u0442")),s.a.createElement("div",{className:"menuItem"},s.a.createElement(m.a,{className:"menuButton",to:"/admin"},"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438")))}}]),t}(s.a.Component)),p=Object(v.a)(b),w=(n(32),function(e){return e.json().then(function(t){return e.ok?t:Promise.reject(t)})}),y=function(e){return localStorage.setItem("token",e)},E=function(){return!!localStorage.getItem("token")&&localStorage.getItem("token")},k={right:"\u041f\u043e\u0437\u0434\u0440\u0430\u0432\u043b\u044f\u0435\u043c! \u041f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442.",yellow:"\u041e\u0448\u0438\u0431\u043a\u0430! \u041e\u043f\u0430\u0441\u043d\u044b\u0445 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u043e\u0432 \u043d\u0435\u0442!",red1:"\u041e\u0448\u0438\u0431\u043a\u0430! \u041e\u043f\u0430\u0441\u043d\u044b\u0439 \u043f\u0440\u0435\u0434\u043c\u0435\u0442 \u0435\u0441\u0442\u044c!",red2:"\u041e\u0448\u0438\u0431\u043a\u0430! \u041e\u043f\u0430\u0441\u043d\u043e\u0433\u043e \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u0430 \u043d\u0435\u0442 \u0432 \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u043e\u0439 \u0412\u0430\u043c\u0438 \u043e\u0431\u043b\u0430\u0441\u0442\u0438!",time:"\u0412\u0440\u0435\u043c\u044f \u0438\u0441\u0442\u0435\u043a\u043b\u043e!"},j=n(21),O=n(11),S=function(){function e(t){Object(o.a)(this,e),this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.zones=[],this.x1=0,this.x2=0,this.y1=0,this.y2=0,this.prevProperties=[0,0,0,0],this.clearListeners(),this.isDrawing=!1,this.handelMouseUp=this.handelMouseUp.bind(this),this.handelMouseMove=this.handelMouseMove.bind(this),this.handelMouseDown=this.handelMouseDown.bind(this),this.clearZones=this.clearZones.bind(this)}return Object(c.a)(e,[{key:"handelMouseDown",value:function(e){this.isDrawing=!0,this.x1=e.offsetX,this.y1=e.offsetY}},{key:"handelMouseMove",value:function(e){if(this.isDrawing){this.clearPreviousRect(),this.x2=e.offsetX,this.y2=e.offsetY;var t=this.getRectProperties();this.drawRect(t),this.prevProperties=t}}},{key:"handelMouseUp",value:function(e){this.isDrawing=!1,this.clearPreviousRect(),this.x2=e.offsetX,this.y2=e.offsetY;var t=this.getRectProperties();this.drawRect(t),this.prevProperties=[0,0,0,0],this.saveZones()}},{key:"drawRect",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red";this.ctx.strokeStyle=n,(t=this.ctx).rect.apply(t,Object(O.a)(e)),this.ctx.stroke()}},{key:"clearPreviousRect",value:function(){var e=Object(j.a)(this.prevProperties,4),t=e[0],n=e[1],a=e[2],s=e[3];this.ctx.clearRect(t-1,n-1,a+2,s+2),this.ctx.beginPath()}},{key:"saveZones",value:function(){var e=this.getLeftUpCorner(),t=this.getRightDownCorner();this.zones.push([].concat(Object(O.a)(e),Object(O.a)(t)))}},{key:"drawOldZones",value:function(e){var t=this;this.zones=e,e.forEach(function(e){var n=[e[0],e[1]],a=e[2]-e[0],s=e[3]-e[1];n.push(a),n.push(s),t.drawRect(n)})}},{key:"getLeftUpCorner",value:function(){var e=this.x1,t=this.x2,n=this.y1,a=this.y2;return[Math.min(e,t),Math.min(n,a)]}},{key:"getRightDownCorner",value:function(){var e=this.x1,t=this.x2,n=this.y1,a=this.y2;return[Math.max(e,t),Math.max(n,a)]}},{key:"getRectProperties",value:function(){var e=this.getLeftUpCorner(),t=this.getRightDownCorner(),n=t[0]-e[0],a=t[1]-e[1];return[].concat(Object(O.a)(e),[n,a])}},{key:"start",value:function(){this.canvas.addEventListener("mousedown",this.handelMouseDown),this.canvas.addEventListener("mouseup",this.handelMouseUp),this.canvas.addEventListener("mousemove",this.handelMouseMove)}},{key:"clearListeners",value:function(){this.canvas.removeEventListener("mousedown",this.handelMouseDown),this.canvas.removeEventListener("mouseup",this.handelMouseUp),this.canvas.removeEventListener("mousemove",this.handelMouseMove)}},{key:"getZones",value:function(){return this.zones}},{key:"clearZones",value:function(){this.zones=[],this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath()}},{key:"reset",value:function(){this.clearListeners(),this.clearZones()}}]),e}(),C=function(e){function t(e){var n;Object(o.a)(this,t);var a=(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).props,s=a.settings,i=a.question;return n.state={settings:s,question:i,canvasBackground:"#canvasBackground",canvasDraw:"#canvasDrawArea",comment:k.right,warningShowed:!1,answered:!1,result:0,slideShowed:!1,photoShowed:!1},n.setClear=n.setClear.bind(Object(d.a)(Object(d.a)(n))),n.nextQuestion=n.nextQuestion.bind(Object(d.a)(Object(d.a)(n))),n.handleCanvasClick=n.handleCanvasClick.bind(Object(d.a)(Object(d.a)(n))),n.clearTimers=n.clearTimers.bind(Object(d.a)(Object(d.a)(n))),n.setQuestionTimers=n.setQuestionTimers.bind(Object(d.a)(Object(d.a)(n))),n.showWarning=n.showWarning.bind(Object(d.a)(Object(d.a)(n))),n.handleTimer=n.handleTimer.bind(Object(d.a)(Object(d.a)(n))),n.prepareCanvas=n.prepareCanvas.bind(Object(d.a)(Object(d.a)(n))),n.setNewQuestion=n.setNewQuestion.bind(Object(d.a)(Object(d.a)(n))),n.showPhoto=n.showPhoto.bind(Object(d.a)(Object(d.a)(n))),n.timers=[],n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.canvasDraw;this.drawer=new S(document.querySelector(e)),this.setNewQuestion()}},{key:"componentDidUpdate",value:function(e,t){var n=e.question;this.props.question.name!==n.name&&this.setNewQuestion()}},{key:"componentWillUnmount",value:function(){this.clearTimers(),this.removeClickListener()}},{key:"setNewQuestion",value:function(){var e=this.props,t=e.settings,n=e.question;this.setState({settings:t,question:n,comment:k.right,answered:!1,slideShowed:!0,warningShowed:!1,result:0},this.prepareCanvas)}},{key:"removeClickListener",value:function(){this.getCanvasDraw().removeEventListener("click",this.handleCanvasClick)}},{key:"prepareCanvas",value:function(){var e=this;this.setCanvasDimensions();var t=new Image;t.src=this.state.question.imgPath,t.onload=function(){e.setCanvasBackground(t),e.animateSlideShow().then(function(){e.setQuestionTimers(),e.setClickListener()}).catch(window.alert)}}},{key:"animateSlideShow",value:function(){var e=this;return new Promise(function(t,n){var a=e.getCanvasBackground(),s=e.getCanvasDraw();a.offsetLeft===s.offsetLeft?t():e.getCanvasBackground().addEventListener("animationend",t)})}},{key:"setCanvasDimensions",value:function(){var e=this.state.question.dimensions,t=e.width,n=e.height;this.getCanvasDraw().width=t,this.getCanvasDraw().height=n,this.getCanvasBackground().width=t,this.getCanvasBackground().height=n}},{key:"setCanvasBackground",value:function(e){return this.getCanvasBackground().getContext("2d").drawImage(e,0,0)}},{key:"drawDangerZone",value:function(e){var t=this.state.question.dangerZones;return t.length>0&&this.drawer.drawOldZones(t)}},{key:"getCanvasDraw",value:function(){return document.querySelector(this.state.canvasDraw)}},{key:"getCanvasBackground",value:function(){return document.querySelector(this.state.canvasBackground)}},{key:"setClear",value:function(){var e=this.state.question.isDanger,t=this.state.settings.redError;"1"===e?this.setState({comment:k.red1,result:t},this.finishQuestion):this.finishQuestion()}},{key:"setClickListener",value:function(){this.getCanvasDraw().addEventListener("click",this.handleCanvasClick)}},{key:"setTimer",value:function(e,t){var n=this.timers.length;this.timers[n]=setTimeout(e,t)}},{key:"setQuestionTimers",value:function(){var e=this.state.settings,t=e.timeWarning,n=e.time;this.setTimer(this.showWarning,1e3*t),this.setTimer(this.handleTimer,1e3*n)}},{key:"clearTimers",value:function(){this.timers.forEach(function(e){clearTimeout(e)}),this.timers=[]}},{key:"handleTimer",value:function(){var e,t=this.state.answered,n=this.state.settings,a=n.redError,s=n.yellowError,i=this.state.question.isDanger;return!t&&(e="1"===i?a:s,this.setState({comment:k.time,answered:!0,result:e},this.finishQuestion))}},{key:"showWarning",value:function(){return this.setState({warningShowed:!0})}},{key:"handleCanvasClick",value:function(e){var t=this.state.answered,n=this.state.question.isDanger,a=this.state.settings.yellowError;return"0"!==n||t?this.checkIfClickInDangerZone(e):this.setState({comment:k.yellow,result:a},this.finishQuestion)}},{key:"checkIfClickInDangerZone",value:function(e){var t=e.offsetX,n=e.offsetY,a=this.state.answered,s=this.state.question.dangerZones,i=this.state.settings.redError,r=s.some(function(e){return t>e[0]&&n>e[1]&&t<e[2]&&n<e[3]});a||(r?this.finishQuestion():this.setState({comment:k.red2,result:i},this.finishQuestion)),r&&this.showPhoto(e)}},{key:"showPhoto",value:function(e){var t=this;this.setState({photoShowed:!0},function(){t.handlePhotoPosition(e),t.setTimer(t.setState.bind(t,{photoShowed:!1}),2e3)})}},{key:"handlePhotoPosition",value:function(e){var t=document.querySelector(".dangerPicture");t.style.top=e.clientY-t.naturalHeight/2+"px",t.style.left=e.clientX-t.naturalWidth/2+"px",this.setTimer(function(){return t.classList.add("naturalSize")},20)}},{key:"finishQuestion",value:function(){this.setState({answered:!0}),this.clearTimers(),this.drawDangerZone(),this.showResult()}},{key:"showResult",value:function(){var e=this.state.result;return(0,this.props.sendResult)(e)}},{key:"nextQuestion",value:function(){var e=this.props.nextQuestion;return this.removeClickListener(),this.setState({slideShowed:!1}),e()}},{key:"render",value:function(){var e=this.state,t=e.answered,n=e.question,a=e.warningShowed,i=e.result,r=e.photoShowed,o=e.comment,c=e.slideShowed,u=this.state.settings.yellowError,l=n.dangerPicture;return s.a.createElement("div",null,s.a.createElement("div",null,"\u0412\u043e\u043f\u0440\u043e\u0441 ",n.name),s.a.createElement("div",{className:"canvasArea"},s.a.createElement("div",{className:"actionComment_container speech"},t?s.a.createElement("div",{id:"actionComment",className:0===i?"green":i===u?"yellow":"red"},t?o:""):""),s.a.createElement("div",{className:"markIcon_cotainer"},t?s.a.createElement("span",{id:"markIcon",className:0===i?"greenMark":i===u?"yellowError":"redError"}):""),s.a.createElement("div",{className:"clearButton_container"},s.a.createElement("button",{id:"clearButton",disabled:t,onClick:this.setClear},"\u2611")),s.a.createElement("div",{className:"canvas_container"},c?s.a.createElement("canvas",{className:"animatedShow",id:"canvasBackground"}):""),s.a.createElement("div",{className:"canvas_container"},s.a.createElement("canvas",{id:"canvasDrawArea"})),s.a.createElement("div",{className:"timerWarning_container"},a?s.a.createElement("span",{id:"timerWarning"},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0412\u0440\u0435\u043c\u044f \u0438\u0441\u0442\u0435\u043a\u0430\u0435\u0442!"):""),s.a.createElement("div",{className:"forwardButton_container"},s.a.createElement("button",{id:"forwardButton",disabled:!t||r,onClick:this.nextQuestion},"\u25ba"))),s.a.createElement("img",{className:r?"dangerPicture":"hidden",src:l,alt:"\u041e\u043f\u0430\u0441\u043d\u044b\u0439 \u043f\u0440\u0435\u0434\u043c\u0435\u0442"}))}}]),t}(s.a.PureComponent),D=Object(v.a)(C),N=(n(33),Object(v.a)(function(e){var t=e.handleSubmit,n=e.handleChange;return s.a.createElement("div",null,s.a.createElement("div",{className:"paranja"}),s.a.createElement("div",{className:"userLoginArea"},s.a.createElement("form",{className:"userLogin",onSubmit:t},s.a.createElement("div",null,s.a.createElement("span",null,s.a.createElement("label",null,"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f: \u2003",s.a.createElement("input",{type:"text",id:"user",onChange:n,required:!0}))),s.a.createElement("span",null,s.a.createElement("input",{type:"submit",value:"\u041d\u0430\u0447\u0430\u0442\u044c \u0442\u0435\u0441\u0442"}))))))})),q=(n(34),n(20)),Q=n.n(q),T="http://K47_8:9245",P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",t=arguments.length>1?arguments[1]:void 0,n={method:e,mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json",token:E()}};return t&&Object.assign(n,{body:JSON.stringify(t)}),n},x=function(e,t){return new Promise(function(n,a){fetch("".concat(T,"/").concat(e),P("POST",t)).then(w).then(function(e){return n(e)}).catch(function(e){return a(e)})})},L=function(e,t){return new Promise(function(n,a){fetch("".concat(T,"/").concat(e),P("GET",t)).then(w).then(function(e){return n(e)}).catch(function(e){return a(e)})})},B=function(e,t){return new Promise(function(n,a){var s;fetch("".concat(T,"/").concat(e),(s=t,{method:"POST",mode:"cors",body:s,headers:{token:E()}})).then(w).then(function(e){return n(e)}).catch(function(e){return a(e)})})},M=function(e,t){return fetch("".concat(T,"/").concat(e),{method:"GET",mode:"cors",headers:{token:E()}}).then(function(e){return e.blob()}).then(function(e){return Q()(e,t)})},R=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(u.a)(this,Object(l.a)(t).call(this))).state={loading:!1,testStarted:!1,testFinished:!1,user:"",settings:{},tests:[],currentTest:"",currentQuestion:-1,questions:[],total:100},e.setSettings=e.setSettings.bind(Object(d.a)(Object(d.a)(e))),e.handleChange=e.handleChange.bind(Object(d.a)(Object(d.a)(e))),e.handleSubmit=e.handleSubmit.bind(Object(d.a)(Object(d.a)(e))),e.nextQuestion=e.nextQuestion.bind(Object(d.a)(Object(d.a)(e))),e.sendResult=e.sendResult.bind(Object(d.a)(Object(d.a)(e))),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getSettings(),this.getTests()}},{key:"handleChange",value:function(e){var t={};t[e.target.id]=e.target.value,this.setState(t)}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.chooseTest()}},{key:"getSettings",value:function(){var e=this;return L("settings").then(function(t){return e.setSettings(t)}).catch(function(t){return e.setState({err:!0})})}},{key:"getTests",value:function(){var e=this;return L("tests").then(function(t){return e.setState({tests:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"setSettings",value:function(e){var t={};e.forEach(function(e){t[e.name]=e.value}),this.setState({settings:t})}},{key:"chooseTest",value:function(){var e=this.state.tests,t=e.length,n=e[Math.floor(Math.random()*t)].name;this.getQuestions(n)}},{key:"getQuestions",value:function(e){var t=this;return L("questions/".concat(e)).then(function(e){return t.setState({questions:e},t.setCurrentQuestion)}).catch(function(e){return window.alert(e)})}},{key:"setCurrentQuestion",value:function(){var e=this.state.currentQuestion+1;e<this.state.questions.length?this.setState({testStarted:!0,currentQuestion:e}):this.setState({testFinished:!0,testStarted:!1})}},{key:"nextQuestion",value:function(){return this.setCurrentQuestion()}},{key:"sendResult",value:function(e){var t=this.state.total;t-=e,this.setState({total:t})}},{key:"render",value:function(){var e=this.state,t=e.testStarted,n=e.settings,a=e.currentQuestion,i=e.questions,r=e.total,o=e.testFinished,c=n.errorThreshold;return s.a.createElement("div",{className:"container"},t?s.a.createElement("div",{className:"testArea"},s.a.createElement("div",null,"\u0418\u0442\u043e\u0433\u043e: ",r,"%"),s.a.createElement(D,{question:i[a],settings:n,sendResult:this.sendResult,nextQuestion:this.nextQuestion})):o?s.a.createElement("div",{className:"resultArea"},s.a.createElement("h2",null,"\u0412\u0430\u0448 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442:",s.a.createElement("span",{className:r<c?"fail":r<100?"enought":"perfect"}," ",r,"%"))):s.a.createElement("div",{className:"userArea"},s.a.createElement(N,{handleChange:this.handleChange,handleSubmit:this.handleSubmit})))}}]),t}(s.a.Component),A=Object(v.a)(R),Z=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(u.a)(this,Object(l.a)(t).call(this))).state={questions:[],settings:[],tests:[],submitting:!1,err:!1},e.deleteObj=e.deleteObj.bind(Object(d.a)(Object(d.a)(e))),e.refreshTest=e.refreshTest.bind(Object(d.a)(Object(d.a)(e))),e.handleChange=e.handleChange.bind(Object(d.a)(Object(d.a)(e))),e.handleSubmit=e.handleSubmit.bind(Object(d.a)(Object(d.a)(e))),e.saveDb=e.saveDb.bind(Object(d.a)(Object(d.a)(e))),e.handleDbRecovery=e.handleDbRecovery.bind(Object(d.a)(Object(d.a)(e))),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.getSettings(),this.getTests(),this.getQuestions()}},{key:"getSettings",value:function(){var e=this;return L("settings").then(function(t){return e.setState({settings:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"getTests",value:function(){var e=this;return L("tests").then(function(t){return e.setState({tests:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"getQuestions",value:function(){var e=this;return L("questions").then(function(t){return e.setState({questions:t})}).catch(function(t){return e.setState({err:!0})})}},{key:"getTestData",value:function(){this.getTests(),this.getQuestions()}},{key:"deleteObj",value:function(e,t){var n,a,s=this;if(window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"))return(n="deleteobj/".concat(e,"/").concat(t),new Promise(function(e,t){fetch("".concat(T,"/").concat(n),P("DELETE",a)).then(w).then(function(t){return e(t)}).catch(function(e){return t(e)})})).then(function(e){return s.getTestData()}).catch(function(e){return s.setState({err:!0})})}},{key:"refreshTest",value:function(e){return x("test",{name:e}).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e!")}).catch(window.alert)}},{key:"handleChange",value:function(e){var t=e.target,n=t.value,a=t.type,s=e.target.dataset.description,i=e.target.id,r=this.state.settings;n=this.handleTypes(n,a),r.forEach(function(e,t){i===e.name&&(r[t]={name:i,value:n,type:a,description:s})}),this.setState({settings:r})}},{key:"handleTypes",value:function(e,t){var n={number:function(){return Number(e)}};return n[t]?n[t](e):e}},{key:"saveDb",value:function(){var e=this;return this.setState({submitting:!0}),L("savedb").then(function(){M("download_dump/tests.json","tests.json"),setTimeout(M.bind(null,"download_dump/questions.json","questions.json"),100)}).catch(window.alert).finally(function(){return e.setState({submitting:!1})})}},{key:"handleDbRecovery",value:function(e){var t=this;if(e.preventDefault(),window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b? \u0422\u0435\u043a\u0443\u0449\u0430\u044f \u0431\u0430\u0437\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0431\u0443\u0434\u0435\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u0430!")){this.setState({submitting:!0});var n=document.querySelector('input[type="file"][name="questions"]'),a=document.querySelector('input[type="file"][name="tests"]'),s=new FormData;return s.append("questions",n.files[0]),s.append("tests",a.files[0]),B("loaddb",s).then(function(){window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e!"),t.getTestData()}).catch(window.alert).finally(function(){return t.setState({submitting:!1})})}}},{key:"handleSubmit",value:function(e){var t=this;e.preventDefault(),this.setState({submitting:!0});var n=this.state.settings;return x("settings",{settings:n}).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!")}).catch(window.alert).finally(function(){return t.setState({submitting:!1})})}},{key:"render",value:function(){var e=this,t=this.state,n=t.settings,a=t.tests,i=t.questions,r=t.submitting;return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"newTest"},s.a.createElement("div",{className:"menuItem"},s.a.createElement(m.a,{className:"menuButton",to:"/create/test"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0442\u0435\u0441\u0442"),s.a.createElement(m.a,{className:"menuButton",to:"/create/question"},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441")),s.a.createElement("div",null,s.a.createElement("button",{disabled:r,className:"menuButton small",onClick:this.saveDb},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0431\u0430\u0437\u0443"),s.a.createElement("form",{onSubmit:this.handleDbRecovery},s.a.createElement("label",null," \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 JSON \u0444\u0430\u0439\u043b \u0441 \u0432\u043e\u043f\u0440\u043e\u0441\u0430\u043c\u0438 \u2003",s.a.createElement("input",{type:"file",name:"questions",accept:".json",required:!0})),s.a.createElement("br",null),s.a.createElement("label",null," \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 JSON \u0444\u0430\u0439\u043b \u0441 \u0442\u0435\u0441\u0442\u0430\u043c\u0438 \u2003",s.a.createElement("input",{type:"file",name:"tests",accept:".json",required:!0})),s.a.createElement("br",null),s.a.createElement("input",{disabled:r,type:"submit",value:"\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0431\u0430\u0437\u0443"})))),s.a.createElement("h2",null,"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"),s.a.createElement("div",{className:"formArea"},s.a.createElement("form",{onSubmit:this.handleSubmit},n.map(function(t){return s.a.createElement("div",{key:t._id},s.a.createElement("label",null,t.description,": \u2003",s.a.createElement("input",{id:t.name,"data-description":t.description,type:t.type,value:t.value,onChange:e.handleChange})))}),s.a.createElement("div",null,s.a.createElement("input",{disabled:r,type:"submit",value:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})))),s.a.createElement("div",null),s.a.createElement("div",{className:"oldTest"},s.a.createElement("h2",null,"\u0422\u0435\u0441\u0442\u044b"),s.a.createElement("ul",null,a.map(function(t){return s.a.createElement("li",{key:t._id},t.name," \u2003",s.a.createElement("a",{onClick:function(){return e.refreshTest(t.name)}},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c")," \u2003",s.a.createElement("a",{className:"danger",onClick:function(){return e.deleteObj("Test",t.name)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))}))),s.a.createElement("div",{className:"oldQuestions"},s.a.createElement("h2",null,"\u0412\u043e\u043f\u0440\u043e\u0441\u044b"),s.a.createElement("ul",null,i.map(function(t){return s.a.createElement("li",{key:t._id},t.name," \u2003",s.a.createElement(m.a,{to:"/create/question?question=".concat(t.name)},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"),"\u2003",s.a.createElement("a",{className:"danger",onClick:function(){return e.deleteObj("Question",t.name)}},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))}))))}}]),t}(s.a.Component),F=Object(v.a)(Z),I=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement("h1",null,"403 \u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u0430"),s.a.createElement("h3",null,"\u0417\u0430\u043b\u043e\u0433\u0438\u043d\u044c\u0442\u0435\u0441\u044c \u0434\u043b\u044f \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044f"))}}]),t}(s.a.Component),U=Object(v.a)(I),_=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(u.a)(this,Object(l.a)(t).call(this))).state={err:!1,loading:!1,name:""},e.handleChange=e.handleChange.bind(Object(d.a)(Object(d.a)(e))),e.handleSubmit=e.handleSubmit.bind(Object(d.a)(Object(d.a)(e))),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"handleSubmit",value:function(e){var t=this;e.preventDefault();var n=this.state.name;return this.setState({loading:!0}),x("test",{name:n}).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!")}).catch(function(e){return window.alert(e)}).finally(function(){return t.setState({loading:!1})})}},{key:"handleChange",value:function(e){var t={};t[e.target.id]=e.target.value,this.setState(t)}},{key:"render",value:function(){var e=this.state.loading;return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"formArea"},s.a.createElement("form",{onSubmit:this.handleSubmit},s.a.createElement("div",null,s.a.createElement("span",null,s.a.createElement("label",null,"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u0441\u0442\u0430: \u2003",s.a.createElement("input",{id:"name",onChange:this.handleChange,type:"number",min:"1"}))),s.a.createElement("span",null,s.a.createElement("input",{disabled:e,type:"submit",value:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}))))))}}]),t}(s.a.Component),W=Object(v.a)(_),z=(n(35),function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(u.a)(this,Object(l.a)(t).call(this))).state={loading:!1,err:!1,imgPath:"",dimensions:{width:0,height:0},dangerZones:[],name:"",isDanger:"1"},e.handleChange=e.handleChange.bind(Object(d.a)(Object(d.a)(e))),e.uploadPhotos=e.uploadPhotos.bind(Object(d.a)(Object(d.a)(e))),e.handleUpload=e.handleUpload.bind(Object(d.a)(Object(d.a)(e))),e.clearCanvas=e.clearCanvas.bind(Object(d.a)(Object(d.a)(e))),e.saveQuestion=e.saveQuestion.bind(Object(d.a)(Object(d.a)(e))),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.setState({canvasBackground:"#canvasBackground",canvasDraw:"#canvasDrawArea"}),this.drawer=this.props.drawer||new S(document.querySelector("#canvasDrawArea")),this.postFile=this.props.postFile||B,this.postData=this.props.postData||x,this.checkIfQuestionCreated()}},{key:"componentWillUnmount",value:function(){this.drawer.reset()}},{key:"getCanvasDraw",value:function(){return document.querySelector(this.state.canvasDraw)}},{key:"getCanvasBackground",value:function(){return document.querySelector(this.state.canvasBackground)}},{key:"checkIfQuestionCreated",value:function(){if(this.props.location&&this.props.location.search.length>0){var e=new URLSearchParams(this.props.location.search).get("question");return this.getQuestion(e)}}},{key:"getQuestion",value:function(e){var t=this;return L("question/".concat(e)).then(function(e){e&&t.setState(e,t.prepareCanvas)}).catch(function(e){return window.alert(e)})}},{key:"uploadPhotos",value:function(e){var t=this;e.preventDefault();var n=this.props.handleFormData||this.handleFormData(),a=this.props.handleUpload||this.handleUpload;this.setState({loading:!0}),this.postFile("preupload",n).then(a).catch(function(e){return window.alert(e)}).finally(function(){return t.setState({loading:!1})})}},{key:"handleUpload",value:function(e){var t=this.state.name,n="/images/".concat(t,"_slide.").concat(e.type);this.drawer.reset(),this.setState({imgPath:n,dimensions:e},this.prepareCanvas)}},{key:"handleFormData",value:function(){var e=document.querySelector('input[name="slide"]'),t=document.querySelector('input[name="photo"]'),n=this.state,a=n.name,s=n.isDanger,i=new FormData;return i.append("question",a),i.append("slide",e.files[0]),"1"===s&&i.append("photo",t.files[0]),i}},{key:"handleChange",value:function(e){var t={};t[e.target.id]=e.target.value,this.setState(t)}},{key:"prepareCanvas",value:function(){var e=this;this.setCanvasDimensions();var t=new Image;t.src=this.state.imgPath,t.onload=function(){e.setCanvasBackground(t),e.drawDangerZone()}}},{key:"setCanvasDimensions",value:function(){var e=this.state.dimensions,t=e.width,n=e.height;this.getCanvasDraw().width=t,this.getCanvasDraw().height=n,this.getCanvasBackground().width=t,this.getCanvasBackground().height=n}},{key:"setCanvasBackground",value:function(e){return this.getCanvasBackground().getContext("2d").drawImage(e,0,0)}},{key:"drawDangerZone",value:function(e){var t=this.state.dangerZones;return t.length>0&&this.drawer.drawOldZones(t),this.drawer.start()}},{key:"clearCanvas",value:function(){return this.drawer.clearZones()}},{key:"saveQuestion",value:function(){var e=this,t=this.state,n=t.imgPath,a=t.name,s=t.isDanger,i=t.dimensions,r={name:a,isDanger:s,dangerZones:this.drawer.getZones(),imgPath:n,dimensions:i};return this.setState({loading:!0}),this.postData("savequestion",r).then(function(e){return window.alert("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043e!")}).catch(function(e){return window.alert(e)}).finally(function(){return e.setState({loading:!1})})}},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.isDanger,a=e.name;return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"formArea"},s.a.createElement("form",{onSubmit:this.uploadPhotos},s.a.createElement("div",null,s.a.createElement("label",null,"\u0412\u043e\u043f\u0440\u043e\u0441: \u2003",s.a.createElement("input",{id:"name",onChange:this.handleChange,pattern:"[0-9]+_[0-9]+",name:"name",type:"text",value:a.length>0?a:"",placeholder:"\u2116 \u0422\u0435\u0441\u0442\u0430_\u2116 \u0432\u043e\u043f\u0440\u043e\u0441\u0430",required:!0}))),s.a.createElement("div",null,s.a.createElement("label",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0441\u043b\u0430\u0439\u0434: \u2003",s.a.createElement("input",{name:"slide",type:"file",required:!0}))),s.a.createElement("div",null,s.a.createElement("label",null,"\u0411\u0430\u0433\u0430\u0436 \u043e\u043f\u0430\u0441\u0435\u043d? \u2003",s.a.createElement("select",{id:"isDanger",onChange:this.handleChange,value:"1"===n?"1":"0"},s.a.createElement("option",{value:"1"},"\u0414\u0430"),s.a.createElement("option",{value:"0"},"\u043d\u0435\u0442")))),"1"===n?s.a.createElement("div",null,s.a.createElement("label",null,"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u0435 \u0444\u043e\u0442\u043e: \u2003",s.a.createElement("input",{name:"photo",type:"file",required:!0}))):s.a.createElement("span",null),s.a.createElement("div",null,s.a.createElement("input",{disabled:t,type:"submit",value:"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c"})))),s.a.createElement("div",null,s.a.createElement("div",{className:"canvasControls"},s.a.createElement("button",{className:"danger",onClick:this.clearCanvas},"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c"),s.a.createElement("button",{className:"success",disabled:t||""===a,onClick:this.saveQuestion},"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")),s.a.createElement("div",{className:"createQuestion canvasArea"},s.a.createElement("canvas",{id:"canvasBackground"}),s.a.createElement("canvas",{id:"canvasDrawArea"}))))}}]),t}(s.a.Component)),X=Object(v.a)(z),J=n(41),Y=n(42),G=n(40),H=(n(36),function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(u.a)(this,Object(l.a)(t).call(this))).state={isAdmin:!1,authFail:!1,isLogging:!1,token:void 0},e.login=e.login.bind(Object(d.a)(Object(d.a)(e))),e.logoff=e.logoff.bind(Object(d.a)(Object(d.a)(e))),e.handleAuth=e.handleAuth.bind(Object(d.a)(Object(d.a)(e))),e}return Object(h.a)(t,e),Object(c.a)(t,[{key:"login",value:function(e){var t=this;e.preventDefault();var n={login:e.target.login.value,password:e.target.password.value};this.setState({isLogging:!0}),x("login",n).then(function(e){return t.handleAuth(e)}).catch(function(e){return console.log(e)}).finally(function(){return t.setState({isLogging:!1})})}},{key:"handleAuth",value:function(e){e.auth&&y(e.token),this.setState({isAdmin:e.auth,authFail:!e.auth,token:e.token})}},{key:"logoff",value:function(){this.setState({isAdmin:!1,token:void 0}),y(null)}},{key:"render",value:function(){var e=this.state,t=e.isAdmin,n=e.authFail,a=e.isLogging;return s.a.createElement(J.a,null,s.a.createElement("div",null,s.a.createElement(g,{isAdmin:t,authFail:n,isLogging:a,login:this.login,logoff:this.logoff}),s.a.createElement(Y.a,null,s.a.createElement(G.a,{path:"/",render:p,exact:!0}),s.a.createElement(G.a,{path:"/test",render:A}),s.a.createElement(G.a,{path:"/admin",render:t?F:U}),s.a.createElement(G.a,{path:"/create/test",render:t?W:U}),s.a.createElement(G.a,{path:"/create/question",render:t?X:U}))))}}]),t}(s.a.Component));r.a.render(s.a.createElement(H,null),document.getElementById("root"))}},[[22,1,2]]]);
//# sourceMappingURL=main.4904dbab.chunk.js.map